{"ast":null,"code":"\"use strict\";\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [http://neo4j.com]\n *\n * This file is part of Neo4j.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.EMPTY_CONNECTION_HOLDER = exports.ReadOnlyConnectionHolder = exports.ConnectionHolder = void 0;\n\nvar error_1 = require(\"../error\");\n\nvar util_1 = require(\"./util\");\n\nvar constants_1 = require(\"./constants\");\n\nvar bookmark_1 = require(\"./bookmark\");\n/**\n * Utility to lazily initialize connections and return them back to the pool when unused.\n * @private\n */\n\n\nvar ConnectionHolder =\n/** @class */\nfunction () {\n  /**\n   * @constructor\n   * @param {string} mode - the access mode for new connection holder.\n   * @param {string} database - the target database name.\n   * @param {Bookmark} bookmark - the last bookmark\n   * @param {ConnectionProvider} connectionProvider - the connection provider to acquire connections from.\n   */\n  function ConnectionHolder(_a) {\n    var _b = _a === void 0 ? {} : _a,\n        _c = _b.mode,\n        mode = _c === void 0 ? constants_1.ACCESS_MODE_WRITE : _c,\n        _d = _b.database,\n        database = _d === void 0 ? '' : _d,\n        bookmark = _b.bookmark,\n        connectionProvider = _b.connectionProvider;\n\n    this._mode = mode;\n    this._database = database ? util_1.assertString(database, 'database') : '';\n    this._bookmark = bookmark || bookmark_1.Bookmark.empty();\n    this._connectionProvider = connectionProvider;\n    this._referenceCount = 0;\n    this._connectionPromise = Promise.resolve();\n  }\n\n  ConnectionHolder.prototype.mode = function () {\n    return this._mode;\n  };\n\n  ConnectionHolder.prototype.database = function () {\n    return this._database;\n  };\n\n  ConnectionHolder.prototype.bookmark = function () {\n    return this._bookmark;\n  };\n\n  ConnectionHolder.prototype.connectionProvider = function () {\n    return this._connectionProvider;\n  };\n\n  ConnectionHolder.prototype.referenceCount = function () {\n    return this._referenceCount;\n  };\n\n  ConnectionHolder.prototype.initializeConnection = function () {\n    if (this._referenceCount === 0 && this._connectionProvider) {\n      this._connectionPromise = this._connectionProvider.acquireConnection({\n        accessMode: this._mode,\n        database: this._database,\n        bookmarks: this._bookmark\n      });\n    } else {\n      this._referenceCount++;\n      return false;\n    }\n\n    this._referenceCount++;\n    return true;\n  };\n\n  ConnectionHolder.prototype.getConnection = function () {\n    return this._connectionPromise;\n  };\n\n  ConnectionHolder.prototype.releaseConnection = function () {\n    if (this._referenceCount === 0) {\n      return this._connectionPromise;\n    }\n\n    this._referenceCount--;\n\n    if (this._referenceCount === 0) {\n      return this._releaseConnection();\n    }\n\n    return this._connectionPromise;\n  };\n\n  ConnectionHolder.prototype.close = function () {\n    if (this._referenceCount === 0) {\n      return this._connectionPromise;\n    }\n\n    this._referenceCount = 0;\n    return this._releaseConnection();\n  };\n  /**\n   * Return the current pooled connection instance to the connection pool.\n   * We don't pool Session instances, to avoid users using the Session after they've called close.\n   * The `Session` object is just a thin wrapper around Connection anyway, so it makes little difference.\n   * @return {Promise} - promise resolved then connection is returned to the pool.\n   * @private\n   */\n\n\n  ConnectionHolder.prototype._releaseConnection = function () {\n    this._connectionPromise = this._connectionPromise.then(function (connection) {\n      if (connection) {\n        return connection.resetAndFlush().catch(ignoreError).then(function () {\n          return connection._release();\n        });\n      } else {\n        return Promise.resolve();\n      }\n    }).catch(ignoreError);\n    return this._connectionPromise;\n  };\n\n  return ConnectionHolder;\n}();\n\nexports.ConnectionHolder = ConnectionHolder;\n/**\n * Provides a interaction with a ConnectionHolder without change it state by\n * releasing or initilizing\n */\n\nvar ReadOnlyConnectionHolder =\n/** @class */\nfunction (_super) {\n  __extends(ReadOnlyConnectionHolder, _super);\n  /**\n   * Contructor\n   * @param {ConnectionHolder} connectionHolder the connection holder which will treat the requests\n   */\n\n\n  function ReadOnlyConnectionHolder(connectionHolder) {\n    var _this = _super.call(this, {\n      mode: connectionHolder.mode(),\n      database: connectionHolder.database(),\n      bookmark: connectionHolder.bookmark(),\n      connectionProvider: connectionHolder.connectionProvider()\n    }) || this;\n\n    _this._connectionHolder = connectionHolder;\n    return _this;\n  }\n  /**\n   * Return the true if the connection is suppose to be initilized with the command.\n   *\n   * @return {boolean}\n   */\n\n\n  ReadOnlyConnectionHolder.prototype.initializeConnection = function () {\n    if (this._connectionHolder.referenceCount() === 0) {\n      return false;\n    }\n\n    return true;\n  };\n  /**\n   * Get the current connection promise.\n   * @return {Promise<Connection>} promise resolved with the current connection.\n   */\n\n\n  ReadOnlyConnectionHolder.prototype.getConnection = function () {\n    return this._connectionHolder.getConnection();\n  };\n  /**\n   * Get the current connection promise, doesn't performs the release\n   * @return {Promise<Connection>} promise with the resolved current connection\n   */\n\n\n  ReadOnlyConnectionHolder.prototype.releaseConnection = function () {\n    return this._connectionHolder.getConnection().catch(function () {\n      return Promise.resolve();\n    });\n  };\n  /**\n   * Get the current connection promise, doesn't performs the connection close\n   * @return {Promise<Connection>} promise with the resolved current connection\n   */\n\n\n  ReadOnlyConnectionHolder.prototype.close = function () {\n    return this._connectionHolder.getConnection().catch(function () {\n      return Promise.resolve();\n    });\n  };\n\n  return ReadOnlyConnectionHolder;\n}(ConnectionHolder);\n\nexports.ReadOnlyConnectionHolder = ReadOnlyConnectionHolder;\nexports.default = ReadOnlyConnectionHolder;\n\nvar EmptyConnectionHolder =\n/** @class */\nfunction (_super) {\n  __extends(EmptyConnectionHolder, _super);\n\n  function EmptyConnectionHolder() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  EmptyConnectionHolder.prototype.mode = function () {\n    return undefined;\n  };\n\n  EmptyConnectionHolder.prototype.database = function () {\n    return undefined;\n  };\n\n  EmptyConnectionHolder.prototype.initializeConnection = function () {\n    // nothing to initialize\n    return true;\n  };\n\n  EmptyConnectionHolder.prototype.getConnection = function () {\n    return Promise.reject(error_1.newError('This connection holder does not serve connections'));\n  };\n\n  EmptyConnectionHolder.prototype.releaseConnection = function () {\n    return Promise.resolve();\n  };\n\n  EmptyConnectionHolder.prototype.close = function () {\n    return Promise.resolve();\n  };\n\n  return EmptyConnectionHolder;\n}(ConnectionHolder);\n/**\n * Connection holder that does not manage any connections.\n * @type {ConnectionHolder}\n * @private\n */\n\n\nvar EMPTY_CONNECTION_HOLDER = new EmptyConnectionHolder();\nexports.EMPTY_CONNECTION_HOLDER = EMPTY_CONNECTION_HOLDER; // eslint-disable-next-line handle-callback-err\n\nfunction ignoreError(error) {}","map":{"version":3,"sources":["/Users/ericyangchen/Downloads/Ont/frontend/node_modules/neo4j-driver-core/lib/internal/connection-holder.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","defineProperty","exports","value","EMPTY_CONNECTION_HOLDER","ReadOnlyConnectionHolder","ConnectionHolder","error_1","require","util_1","constants_1","bookmark_1","_a","_b","_c","mode","ACCESS_MODE_WRITE","_d","database","bookmark","connectionProvider","_mode","_database","assertString","_bookmark","Bookmark","empty","_connectionProvider","_referenceCount","_connectionPromise","Promise","resolve","referenceCount","initializeConnection","acquireConnection","accessMode","bookmarks","getConnection","releaseConnection","_releaseConnection","close","then","connection","resetAndFlush","catch","ignoreError","_release","_super","connectionHolder","_this","_connectionHolder","default","EmptyConnectionHolder","apply","arguments","undefined","reject","newError","error"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIA,SAAS,GAAI,QAAQ,KAAKA,SAAd,IAA6B,YAAY;AACrD,MAAIC,aAAa,GAAG,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAChCF,IAAAA,aAAa,GAAGG,MAAM,CAACC,cAAP,IACX;AAAEC,MAAAA,SAAS,EAAE;AAAb,iBAA6BC,KAA7B,IAAsC,UAAUL,CAAV,EAAaC,CAAb,EAAgB;AAAED,MAAAA,CAAC,CAACI,SAAF,GAAcH,CAAd;AAAkB,KAD/D,IAEZ,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AAAE,WAAK,IAAIK,CAAT,IAAcL,CAAd,EAAiB,IAAIC,MAAM,CAACK,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,CAArC,EAAwCK,CAAxC,CAAJ,EAAgDN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AAAc,KAFrG;;AAGA,WAAOP,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAApB;AACH,GALD;;AAMA,SAAO,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AACnB,QAAI,OAAOA,CAAP,KAAa,UAAb,IAA2BA,CAAC,KAAK,IAArC,EACI,MAAM,IAAIS,SAAJ,CAAc,yBAAyBC,MAAM,CAACV,CAAD,CAA/B,GAAqC,+BAAnD,CAAN;AACJF,IAAAA,aAAa,CAACC,CAAD,EAAIC,CAAJ,CAAb;;AACA,aAASW,EAAT,GAAc;AAAE,WAAKC,WAAL,GAAmBb,CAAnB;AAAuB;;AACvCA,IAAAA,CAAC,CAACO,SAAF,GAAcN,CAAC,KAAK,IAAN,GAAaC,MAAM,CAACY,MAAP,CAAcb,CAAd,CAAb,IAAiCW,EAAE,CAACL,SAAH,GAAeN,CAAC,CAACM,SAAjB,EAA4B,IAAIK,EAAJ,EAA7D,CAAd;AACH,GAND;AAOH,CAd2C,EAA5C;;AAeAV,MAAM,CAACa,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,uBAAR,GAAkCF,OAAO,CAACG,wBAAR,GAAmCH,OAAO,CAACI,gBAAR,GAA2B,KAAK,CAArG;;AACA,IAAIC,OAAO,GAAGC,OAAO,CAAC,UAAD,CAArB;;AACA,IAAIC,MAAM,GAAGD,OAAO,CAAC,QAAD,CAApB;;AACA,IAAIE,WAAW,GAAGF,OAAO,CAAC,aAAD,CAAzB;;AACA,IAAIG,UAAU,GAAGH,OAAO,CAAC,YAAD,CAAxB;AACA;AACA;AACA;AACA;;;AACA,IAAIF,gBAAgB;AAAG;AAAe,YAAY;AAC9C;AACJ;AACA;AACA;AACA;AACA;AACA;AACI,WAASA,gBAAT,CAA0BM,EAA1B,EAA8B;AAC1B,QAAIC,EAAE,GAAGD,EAAE,KAAK,KAAK,CAAZ,GAAgB,EAAhB,GAAqBA,EAA9B;AAAA,QAAkCE,EAAE,GAAGD,EAAE,CAACE,IAA1C;AAAA,QAAgDA,IAAI,GAAGD,EAAE,KAAK,KAAK,CAAZ,GAAgBJ,WAAW,CAACM,iBAA5B,GAAgDF,EAAvG;AAAA,QAA2GG,EAAE,GAAGJ,EAAE,CAACK,QAAnH;AAAA,QAA6HA,QAAQ,GAAGD,EAAE,KAAK,KAAK,CAAZ,GAAgB,EAAhB,GAAqBA,EAA7J;AAAA,QAAiKE,QAAQ,GAAGN,EAAE,CAACM,QAA/K;AAAA,QAAyLC,kBAAkB,GAAGP,EAAE,CAACO,kBAAjN;;AACA,SAAKC,KAAL,GAAaN,IAAb;AACA,SAAKO,SAAL,GAAiBJ,QAAQ,GAAGT,MAAM,CAACc,YAAP,CAAoBL,QAApB,EAA8B,UAA9B,CAAH,GAA+C,EAAxE;AACA,SAAKM,SAAL,GAAiBL,QAAQ,IAAIR,UAAU,CAACc,QAAX,CAAoBC,KAApB,EAA7B;AACA,SAAKC,mBAAL,GAA2BP,kBAA3B;AACA,SAAKQ,eAAL,GAAuB,CAAvB;AACA,SAAKC,kBAAL,GAA0BC,OAAO,CAACC,OAAR,EAA1B;AACH;;AACDzB,EAAAA,gBAAgB,CAACb,SAAjB,CAA2BsB,IAA3B,GAAkC,YAAY;AAC1C,WAAO,KAAKM,KAAZ;AACH,GAFD;;AAGAf,EAAAA,gBAAgB,CAACb,SAAjB,CAA2ByB,QAA3B,GAAsC,YAAY;AAC9C,WAAO,KAAKI,SAAZ;AACH,GAFD;;AAGAhB,EAAAA,gBAAgB,CAACb,SAAjB,CAA2B0B,QAA3B,GAAsC,YAAY;AAC9C,WAAO,KAAKK,SAAZ;AACH,GAFD;;AAGAlB,EAAAA,gBAAgB,CAACb,SAAjB,CAA2B2B,kBAA3B,GAAgD,YAAY;AACxD,WAAO,KAAKO,mBAAZ;AACH,GAFD;;AAGArB,EAAAA,gBAAgB,CAACb,SAAjB,CAA2BuC,cAA3B,GAA4C,YAAY;AACpD,WAAO,KAAKJ,eAAZ;AACH,GAFD;;AAGAtB,EAAAA,gBAAgB,CAACb,SAAjB,CAA2BwC,oBAA3B,GAAkD,YAAY;AAC1D,QAAI,KAAKL,eAAL,KAAyB,CAAzB,IAA8B,KAAKD,mBAAvC,EAA4D;AACxD,WAAKE,kBAAL,GAA0B,KAAKF,mBAAL,CAAyBO,iBAAzB,CAA2C;AACjEC,QAAAA,UAAU,EAAE,KAAKd,KADgD;AAEjEH,QAAAA,QAAQ,EAAE,KAAKI,SAFkD;AAGjEc,QAAAA,SAAS,EAAE,KAAKZ;AAHiD,OAA3C,CAA1B;AAKH,KAND,MAOK;AACD,WAAKI,eAAL;AACA,aAAO,KAAP;AACH;;AACD,SAAKA,eAAL;AACA,WAAO,IAAP;AACH,GAdD;;AAeAtB,EAAAA,gBAAgB,CAACb,SAAjB,CAA2B4C,aAA3B,GAA2C,YAAY;AACnD,WAAO,KAAKR,kBAAZ;AACH,GAFD;;AAGAvB,EAAAA,gBAAgB,CAACb,SAAjB,CAA2B6C,iBAA3B,GAA+C,YAAY;AACvD,QAAI,KAAKV,eAAL,KAAyB,CAA7B,EAAgC;AAC5B,aAAO,KAAKC,kBAAZ;AACH;;AACD,SAAKD,eAAL;;AACA,QAAI,KAAKA,eAAL,KAAyB,CAA7B,EAAgC;AAC5B,aAAO,KAAKW,kBAAL,EAAP;AACH;;AACD,WAAO,KAAKV,kBAAZ;AACH,GATD;;AAUAvB,EAAAA,gBAAgB,CAACb,SAAjB,CAA2B+C,KAA3B,GAAmC,YAAY;AAC3C,QAAI,KAAKZ,eAAL,KAAyB,CAA7B,EAAgC;AAC5B,aAAO,KAAKC,kBAAZ;AACH;;AACD,SAAKD,eAAL,GAAuB,CAAvB;AACA,WAAO,KAAKW,kBAAL,EAAP;AACH,GAND;AAOA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACIjC,EAAAA,gBAAgB,CAACb,SAAjB,CAA2B8C,kBAA3B,GAAgD,YAAY;AACxD,SAAKV,kBAAL,GAA0B,KAAKA,kBAAL,CACrBY,IADqB,CAChB,UAAUC,UAAV,EAAsB;AAC5B,UAAIA,UAAJ,EAAgB;AACZ,eAAOA,UAAU,CACZC,aADE,GAEFC,KAFE,CAEIC,WAFJ,EAGFJ,IAHE,CAGG,YAAY;AAAE,iBAAOC,UAAU,CAACI,QAAX,EAAP;AAA+B,SAHhD,CAAP;AAIH,OALD,MAMK;AACD,eAAOhB,OAAO,CAACC,OAAR,EAAP;AACH;AACJ,KAXyB,EAYrBa,KAZqB,CAYfC,WAZe,CAA1B;AAaA,WAAO,KAAKhB,kBAAZ;AACH,GAfD;;AAgBA,SAAOvB,gBAAP;AACH,CA3FqC,EAAtC;;AA4FAJ,OAAO,CAACI,gBAAR,GAA2BA,gBAA3B;AACA;AACA;AACA;AACA;;AACA,IAAID,wBAAwB;AAAG;AAAe,UAAU0C,MAAV,EAAkB;AAC5D/D,EAAAA,SAAS,CAACqB,wBAAD,EAA2B0C,MAA3B,CAAT;AACA;AACJ;AACA;AACA;;;AACI,WAAS1C,wBAAT,CAAkC2C,gBAAlC,EAAoD;AAChD,QAAIC,KAAK,GAAGF,MAAM,CAACpD,IAAP,CAAY,IAAZ,EAAkB;AAC1BoB,MAAAA,IAAI,EAAEiC,gBAAgB,CAACjC,IAAjB,EADoB;AAE1BG,MAAAA,QAAQ,EAAE8B,gBAAgB,CAAC9B,QAAjB,EAFgB;AAG1BC,MAAAA,QAAQ,EAAE6B,gBAAgB,CAAC7B,QAAjB,EAHgB;AAI1BC,MAAAA,kBAAkB,EAAE4B,gBAAgB,CAAC5B,kBAAjB;AAJM,KAAlB,KAKN,IALN;;AAMA6B,IAAAA,KAAK,CAACC,iBAAN,GAA0BF,gBAA1B;AACA,WAAOC,KAAP;AACH;AACD;AACJ;AACA;AACA;AACA;;;AACI5C,EAAAA,wBAAwB,CAACZ,SAAzB,CAAmCwC,oBAAnC,GAA0D,YAAY;AAClE,QAAI,KAAKiB,iBAAL,CAAuBlB,cAAvB,OAA4C,CAAhD,EAAmD;AAC/C,aAAO,KAAP;AACH;;AACD,WAAO,IAAP;AACH,GALD;AAMA;AACJ;AACA;AACA;;;AACI3B,EAAAA,wBAAwB,CAACZ,SAAzB,CAAmC4C,aAAnC,GAAmD,YAAY;AAC3D,WAAO,KAAKa,iBAAL,CAAuBb,aAAvB,EAAP;AACH,GAFD;AAGA;AACJ;AACA;AACA;;;AACIhC,EAAAA,wBAAwB,CAACZ,SAAzB,CAAmC6C,iBAAnC,GAAuD,YAAY;AAC/D,WAAO,KAAKY,iBAAL,CAAuBb,aAAvB,GAAuCO,KAAvC,CAA6C,YAAY;AAAE,aAAOd,OAAO,CAACC,OAAR,EAAP;AAA2B,KAAtF,CAAP;AACH,GAFD;AAGA;AACJ;AACA;AACA;;;AACI1B,EAAAA,wBAAwB,CAACZ,SAAzB,CAAmC+C,KAAnC,GAA2C,YAAY;AACnD,WAAO,KAAKU,iBAAL,CAAuBb,aAAvB,GAAuCO,KAAvC,CAA6C,YAAY;AAAE,aAAOd,OAAO,CAACC,OAAR,EAAP;AAA2B,KAAtF,CAAP;AACH,GAFD;;AAGA,SAAO1B,wBAAP;AACH,CAjD6C,CAiD5CC,gBAjD4C,CAA9C;;AAkDAJ,OAAO,CAACG,wBAAR,GAAmCA,wBAAnC;AACAH,OAAO,CAACiD,OAAR,GAAkB9C,wBAAlB;;AACA,IAAI+C,qBAAqB;AAAG;AAAe,UAAUL,MAAV,EAAkB;AACzD/D,EAAAA,SAAS,CAACoE,qBAAD,EAAwBL,MAAxB,CAAT;;AACA,WAASK,qBAAT,GAAiC;AAC7B,WAAOL,MAAM,KAAK,IAAX,IAAmBA,MAAM,CAACM,KAAP,CAAa,IAAb,EAAmBC,SAAnB,CAAnB,IAAoD,IAA3D;AACH;;AACDF,EAAAA,qBAAqB,CAAC3D,SAAtB,CAAgCsB,IAAhC,GAAuC,YAAY;AAC/C,WAAOwC,SAAP;AACH,GAFD;;AAGAH,EAAAA,qBAAqB,CAAC3D,SAAtB,CAAgCyB,QAAhC,GAA2C,YAAY;AACnD,WAAOqC,SAAP;AACH,GAFD;;AAGAH,EAAAA,qBAAqB,CAAC3D,SAAtB,CAAgCwC,oBAAhC,GAAuD,YAAY;AAC/D;AACA,WAAO,IAAP;AACH,GAHD;;AAIAmB,EAAAA,qBAAqB,CAAC3D,SAAtB,CAAgC4C,aAAhC,GAAgD,YAAY;AACxD,WAAOP,OAAO,CAAC0B,MAAR,CAAejD,OAAO,CAACkD,QAAR,CAAiB,mDAAjB,CAAf,CAAP;AACH,GAFD;;AAGAL,EAAAA,qBAAqB,CAAC3D,SAAtB,CAAgC6C,iBAAhC,GAAoD,YAAY;AAC5D,WAAOR,OAAO,CAACC,OAAR,EAAP;AACH,GAFD;;AAGAqB,EAAAA,qBAAqB,CAAC3D,SAAtB,CAAgC+C,KAAhC,GAAwC,YAAY;AAChD,WAAOV,OAAO,CAACC,OAAR,EAAP;AACH,GAFD;;AAGA,SAAOqB,qBAAP;AACH,CAzB0C,CAyBzC9C,gBAzByC,CAA3C;AA0BA;AACA;AACA;AACA;AACA;;;AACA,IAAIF,uBAAuB,GAAG,IAAIgD,qBAAJ,EAA9B;AACAlD,OAAO,CAACE,uBAAR,GAAkCA,uBAAlC,C,CACA;;AACA,SAASyC,WAAT,CAAqBa,KAArB,EAA4B,CAAG","sourcesContent":["\"use strict\";\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [http://neo4j.com]\n *\n * This file is part of Neo4j.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.EMPTY_CONNECTION_HOLDER = exports.ReadOnlyConnectionHolder = exports.ConnectionHolder = void 0;\nvar error_1 = require(\"../error\");\nvar util_1 = require(\"./util\");\nvar constants_1 = require(\"./constants\");\nvar bookmark_1 = require(\"./bookmark\");\n/**\n * Utility to lazily initialize connections and return them back to the pool when unused.\n * @private\n */\nvar ConnectionHolder = /** @class */ (function () {\n    /**\n     * @constructor\n     * @param {string} mode - the access mode for new connection holder.\n     * @param {string} database - the target database name.\n     * @param {Bookmark} bookmark - the last bookmark\n     * @param {ConnectionProvider} connectionProvider - the connection provider to acquire connections from.\n     */\n    function ConnectionHolder(_a) {\n        var _b = _a === void 0 ? {} : _a, _c = _b.mode, mode = _c === void 0 ? constants_1.ACCESS_MODE_WRITE : _c, _d = _b.database, database = _d === void 0 ? '' : _d, bookmark = _b.bookmark, connectionProvider = _b.connectionProvider;\n        this._mode = mode;\n        this._database = database ? util_1.assertString(database, 'database') : '';\n        this._bookmark = bookmark || bookmark_1.Bookmark.empty();\n        this._connectionProvider = connectionProvider;\n        this._referenceCount = 0;\n        this._connectionPromise = Promise.resolve();\n    }\n    ConnectionHolder.prototype.mode = function () {\n        return this._mode;\n    };\n    ConnectionHolder.prototype.database = function () {\n        return this._database;\n    };\n    ConnectionHolder.prototype.bookmark = function () {\n        return this._bookmark;\n    };\n    ConnectionHolder.prototype.connectionProvider = function () {\n        return this._connectionProvider;\n    };\n    ConnectionHolder.prototype.referenceCount = function () {\n        return this._referenceCount;\n    };\n    ConnectionHolder.prototype.initializeConnection = function () {\n        if (this._referenceCount === 0 && this._connectionProvider) {\n            this._connectionPromise = this._connectionProvider.acquireConnection({\n                accessMode: this._mode,\n                database: this._database,\n                bookmarks: this._bookmark\n            });\n        }\n        else {\n            this._referenceCount++;\n            return false;\n        }\n        this._referenceCount++;\n        return true;\n    };\n    ConnectionHolder.prototype.getConnection = function () {\n        return this._connectionPromise;\n    };\n    ConnectionHolder.prototype.releaseConnection = function () {\n        if (this._referenceCount === 0) {\n            return this._connectionPromise;\n        }\n        this._referenceCount--;\n        if (this._referenceCount === 0) {\n            return this._releaseConnection();\n        }\n        return this._connectionPromise;\n    };\n    ConnectionHolder.prototype.close = function () {\n        if (this._referenceCount === 0) {\n            return this._connectionPromise;\n        }\n        this._referenceCount = 0;\n        return this._releaseConnection();\n    };\n    /**\n     * Return the current pooled connection instance to the connection pool.\n     * We don't pool Session instances, to avoid users using the Session after they've called close.\n     * The `Session` object is just a thin wrapper around Connection anyway, so it makes little difference.\n     * @return {Promise} - promise resolved then connection is returned to the pool.\n     * @private\n     */\n    ConnectionHolder.prototype._releaseConnection = function () {\n        this._connectionPromise = this._connectionPromise\n            .then(function (connection) {\n            if (connection) {\n                return connection\n                    .resetAndFlush()\n                    .catch(ignoreError)\n                    .then(function () { return connection._release(); });\n            }\n            else {\n                return Promise.resolve();\n            }\n        })\n            .catch(ignoreError);\n        return this._connectionPromise;\n    };\n    return ConnectionHolder;\n}());\nexports.ConnectionHolder = ConnectionHolder;\n/**\n * Provides a interaction with a ConnectionHolder without change it state by\n * releasing or initilizing\n */\nvar ReadOnlyConnectionHolder = /** @class */ (function (_super) {\n    __extends(ReadOnlyConnectionHolder, _super);\n    /**\n     * Contructor\n     * @param {ConnectionHolder} connectionHolder the connection holder which will treat the requests\n     */\n    function ReadOnlyConnectionHolder(connectionHolder) {\n        var _this = _super.call(this, {\n            mode: connectionHolder.mode(),\n            database: connectionHolder.database(),\n            bookmark: connectionHolder.bookmark(),\n            connectionProvider: connectionHolder.connectionProvider()\n        }) || this;\n        _this._connectionHolder = connectionHolder;\n        return _this;\n    }\n    /**\n     * Return the true if the connection is suppose to be initilized with the command.\n     *\n     * @return {boolean}\n     */\n    ReadOnlyConnectionHolder.prototype.initializeConnection = function () {\n        if (this._connectionHolder.referenceCount() === 0) {\n            return false;\n        }\n        return true;\n    };\n    /**\n     * Get the current connection promise.\n     * @return {Promise<Connection>} promise resolved with the current connection.\n     */\n    ReadOnlyConnectionHolder.prototype.getConnection = function () {\n        return this._connectionHolder.getConnection();\n    };\n    /**\n     * Get the current connection promise, doesn't performs the release\n     * @return {Promise<Connection>} promise with the resolved current connection\n     */\n    ReadOnlyConnectionHolder.prototype.releaseConnection = function () {\n        return this._connectionHolder.getConnection().catch(function () { return Promise.resolve(); });\n    };\n    /**\n     * Get the current connection promise, doesn't performs the connection close\n     * @return {Promise<Connection>} promise with the resolved current connection\n     */\n    ReadOnlyConnectionHolder.prototype.close = function () {\n        return this._connectionHolder.getConnection().catch(function () { return Promise.resolve(); });\n    };\n    return ReadOnlyConnectionHolder;\n}(ConnectionHolder));\nexports.ReadOnlyConnectionHolder = ReadOnlyConnectionHolder;\nexports.default = ReadOnlyConnectionHolder;\nvar EmptyConnectionHolder = /** @class */ (function (_super) {\n    __extends(EmptyConnectionHolder, _super);\n    function EmptyConnectionHolder() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    EmptyConnectionHolder.prototype.mode = function () {\n        return undefined;\n    };\n    EmptyConnectionHolder.prototype.database = function () {\n        return undefined;\n    };\n    EmptyConnectionHolder.prototype.initializeConnection = function () {\n        // nothing to initialize\n        return true;\n    };\n    EmptyConnectionHolder.prototype.getConnection = function () {\n        return Promise.reject(error_1.newError('This connection holder does not serve connections'));\n    };\n    EmptyConnectionHolder.prototype.releaseConnection = function () {\n        return Promise.resolve();\n    };\n    EmptyConnectionHolder.prototype.close = function () {\n        return Promise.resolve();\n    };\n    return EmptyConnectionHolder;\n}(ConnectionHolder));\n/**\n * Connection holder that does not manage any connections.\n * @type {ConnectionHolder}\n * @private\n */\nvar EMPTY_CONNECTION_HOLDER = new EmptyConnectionHolder();\nexports.EMPTY_CONNECTION_HOLDER = EMPTY_CONNECTION_HOLDER;\n// eslint-disable-next-line handle-callback-err\nfunction ignoreError(error) { }\n"]},"metadata":{},"sourceType":"script"}